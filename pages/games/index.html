<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Game Catalog</title>
  <link rel="icon" type="image/gif" href="https://gp-site.github.io/gp/img/logo.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <script src="https://unpkg.com/@ruffle-rs/ruffle"></script>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      font-family: "Montserrat", "Segoe UI", Arial, sans-serif;
      background: #101520;
      overflow: hidden;
    }
    body {
      display: flex;
      height: 100vh;
      overflow: hidden;
      color: #FFD900;
      position: relative;
      z-index: 2;
    }
    #bg-canvas {
      position: fixed;
      left: 0; top: 0;
      width: 100vw; height: 100vh;
      z-index: 0;
      pointer-events: none;
      display: block;
    }
    /* Sidebar */
    .sidebar {
      width: 88px;
      background: rgba(16,18,29,0.60);
      border-radius: 24px;
      margin: 36px 18px 36px 36px;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      padding-bottom: 18px;
      box-shadow: 0 8px 32px #FFD90022, 0 2px 8px #23232344;
      backdrop-filter: blur(8px);
    }
    .circle-btn {
      width: 54px; height: 54px;
      background: rgba(30,32,40,0.28);
      border-radius: 50%;
      margin: 16px 0;
      display: flex;
      justify-content: center;
      align-items: center;
      color: #FFD900;
      font-size: 22px;
      cursor: pointer;
      position: relative;
      transition: 
        background 0.18s,
        color 0.18s,
        box-shadow 0.18s,
        transform 0.13s;
      box-shadow: 0 6px 24px #FFD90026;
      border: 2.5px solid #FFD900;
      outline: none;
      z-index: 2;
    }
    .circle-btn:hover, .circle-btn:focus {
      background: rgba(255,217,0,0.25);
      color: #101520;
      transform: scale(1.11);
      box-shadow: 0 12px 44px #FFD90077;
      border-color: #FFD900;
    }
    .circle-btn input {
      position: absolute;
      left: 62px;
      width: 0;
      opacity: 0;
      border: none;
      outline: none;
      padding: 7px 13px;
      border-radius: 12px;
      background: rgba(30,32,40,0.34);
      color: #FFD900;
      font-size: 15px;
      font-family: "Montserrat", Arial, sans-serif;
      transition: all 0.3s cubic-bezier(.42,0,.58,1.0);
      box-shadow: 0 2px 14px #FFD90022;
      backdrop-filter: blur(8px);
    }
    .circle-btn.active input {
      height: 30px;
      width: 210px;
      opacity: 1;
    }
    .filter-menu {
      position: absolute;
      top: 0; left: 67px;
      background: rgba(30,32,40,0.32);
      border-radius: 13px;
      padding: 0;
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
      gap: 7px;
      max-width: 210px;
      opacity: 0;
      pointer-events: none;
      transition: all 0.3s cubic-bezier(.42,0,.58,1.0);
      z-index: 3;
      box-shadow: 0 4px 18px #FFD90033;
      backdrop-filter: blur(6px);
    }
    .circle-btn.active .filter-menu {
      max-height: 420px;
      opacity: 1;
      padding: 14px;
      pointer-events: auto;
      user-select: auto;
    }
    .filter-menu button {
      background: rgba(30,32,40,0.27);
      color: #FFD900;
      border: 2px solid #FFD900;
      padding: 6px 12px;
      border-radius: 8px;
      white-space: nowrap;
      cursor: pointer;
      text-align: left;
      font-family: "Montserrat", Arial, sans-serif;
      font-size: 13px;
      transition: background 0.18s, color 0.18s;
    }
    .filter-menu button:hover {
      background: rgba(255,217,0,0.18);
      color: #101520;
      border-color: #FFD900;
    }
    .scrollbar {
      flex: 1; width: 100%;
      display: flex; justify-content: center;
      margin: 18px 0; position: relative;
    }
    .track {
      position: absolute;
      top: 13px; bottom: 13px;
      width: 12px;
      border-radius: 7px;
      background: rgba(30,32,40,0.19);
      box-shadow: 0 2px 8px #FFD90010;
    }
    .thumb {
      width: 60px; height: 38px;
      background: rgba(30,32,40,0.22);
      border-radius: 12px;
      position: absolute; top: 0;
      cursor: grab;
      display: flex; flex-direction: column;
      justify-content: center; align-items: center;
      box-shadow: 0 4px 16px #FFD90022;
      border: 2px solid #FFD900;
    }
    .thumb div {
      width: 40%; height: 3px;
      background: #FFD900;
      margin: 2px 0;
      border-radius: 2px;
    }
    #homeBtn { margin-top: auto; }

    /* Catalog container */
    .catalog-frame {
      flex: 1;
      margin: 36px 36px 36px 0;
      border-radius: 24px;
      background: rgba(16,18,29,0.57);
      padding: 16px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      box-shadow: 0 8px 32px #FFD90022, 0 2px 8px #23232344;
      backdrop-filter: blur(8px);
    }
    .catalog-inner {
      flex: 1;
      border-radius: 17px;
      background: rgba(30,32,40,0.37);
      padding: 18px;
      overflow-y: scroll;
      scrollbar-width: none;
      box-shadow: 0 2px 12px #FFD90022;
      backdrop-filter: blur(6px);
    }
    .catalog-inner::-webkit-scrollbar { display: none; }

    .game-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 26px;
      margin-bottom: 16px;
    }
    .game-card {
      background: rgba(30,32,40,0.31);
      border-radius: 16px;
      padding: 10px 8px 10px 8px;
      text-align: center;
      cursor: pointer;
      box-shadow: 0 4px 18px #FFD90022;
      border: 2px solid #FFD900;
      transition: 
        background 0.17s,
        box-shadow 0.17s,
        border-color 0.14s,
        transform 0.13s;
    }
    .game-card:hover {
      background: rgba(255,217,0,0.15);
      color: #101520;
      box-shadow: 0 8px 32px #FFD90088;
      border-color: #FFD900;
      transform: scale(1.04);
    }
    .game-card h3 { font-size: 15px; margin: 8px 0; color: #FFD900; font-family: "Montserrat", Arial, sans-serif; }
    .game-card img {
      width: 100%; aspect-ratio: 1 / 1;
      object-fit: cover;
      border-radius: 11px;
      background: #444;
      box-shadow: 0 2px 12px #FFD90011;
      border: 2px solid #FFD90022;
    }
    .game-card p { font-size: 12px; color: #FFD900; margin: 8px 0 0; }

    /* Overlay for game iframe */
    .game-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: rgba(16,18,29,0.97);
      display: none;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      z-index: 9999;
      backdrop-filter: blur(7px);
      animation: fadeinOverlay .33s cubic-bezier(.42,0,.58,1.0);
    }
    @keyframes fadeinOverlay {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .game-overlay iframe, .game-overlay object {
      width: 80vw;
      height: 80vh;
      border: none;
      border-radius: 14px;
      background: #101520;
      box-shadow: 0 4px 44px #FFD90033;
      border: 2px solid #FFD900;
    }
    .overlay-controls {
      margin-top: 16px;
      display: flex;
      gap: 14px;
    }
    .overlay-controls button {
      background: rgba(30,32,40,0.22);
      color: #FFD900;
      border: 2px solid #FFD900;
      border-radius: 10px;
      padding: 11px 22px;
      cursor: pointer;
      font-size: 1.11rem;
      font-family: "Montserrat", Arial, sans-serif;
      font-weight: 700;
      box-shadow: 0 2px 12px #FFD90022;
      backdrop-filter: blur(6px);
      transition: background 0.16s, color 0.16s, border-color 0.14s;
    }
    .overlay-controls button:hover {
      background: rgba(255,217,0,0.18);
      color: #101520;
      border-color: #FFD900;
    }

    @media(max-width:900px){
      .sidebar { margin: 20px 10px 20px 10px; }
      .catalog-frame { margin: 20px 10px 20px 0; }
      .game-overlay iframe, .game-overlay object { width: 96vw; height: 65vh;}
      .game-grid { grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 18px;}
    }
    @media(max-width:600px){
      .sidebar { width: 60px; margin: 8px 2px 8px 2px;}
      .circle-btn { width: 35px; height: 35px; font-size: 16px;}
      .catalog-frame { margin: 8px 2px 8px 0; border-radius: 14px; }
      .catalog-inner { border-radius: 10px; padding: 6px;}
      .game-card { border-radius: 7px; padding: 6px 3px;}
      .game-card h3 { font-size: 11px;}
      .game-card p { font-size: 9px;}
      .game-card img { border-radius: 6px;}
      .game-grid { grid-template-columns: repeat(auto-fill, minmax(90px, 1fr)); gap: 8px;}
      .overlay-controls button { font-size: 0.95rem; padding: 7px 11px; border-radius: 7px;}
      .game-overlay iframe, .game-overlay object { width: 97vw; height: 48vh;}
    }
  </style>
</head>
<body>
  <!-- Starry Background Canvas -->
  <canvas id="bg-canvas"></canvas>
  <!-- Sidebar -->
  <div class="sidebar">
    <div class="circle-btn" id="searchBtn"><i class="fa fa-search"></i><input type="text" id="searchInput" placeholder="Search..."></div>
    <div class="circle-btn" id="filterBtn"><i class="fa fa-filter"></i><div class="filter-menu" id="filterMenu"></div></div>
    <div class="scrollbar"><div class="track"></div><div class="thumb"><div></div><div></div><div></div></div></div>
    <a class="circle-btn" id="homeBtn" href="../../index.html"><i class="fa fa-home"></i></a>
  </div>

  <!-- Catalog -->
  <div class="catalog-frame">
    <div class="catalog-inner" id="catalog">
      <div class="game-grid" id="gameGrid"></div>
    </div>
  </div>

  <!-- Overlay -->
  <div class="game-overlay" id="gameOverlay">
    <div id="gameContainer"></div>
    <div class="overlay-controls">
      <button onclick="toggleFullscreen()">Fullscreen</button>
      <button onclick="closeOverlay()">Close</button>
    </div>
  </div>

  <script>
    // Starry/nebula background
    const canvas = document.getElementById('bg-canvas');
    const ctx = canvas.getContext('2d');
    let w = window.innerWidth, h = window.innerHeight;
    function resize() {
      w = window.innerWidth;
      h = window.innerHeight;
      canvas.width = w;
      canvas.height = h;
    }
    window.addEventListener('resize', resize);
    resize();

    // Nebula swirl
    function drawNebula(t) {
      for(let i=0;i<3;i++){
        let angle = t/7000+i*2;
        let cx = w/2 + Math.cos(angle)*w*0.22 + Math.sin(t/(5000+i*900))*w*0.11;
        let cy = h/2 + Math.sin(angle)*h*0.18 + Math.cos(t/(4000+i*700))*h*0.08;
        let r = w*0.21+Math.sin(t/(2300+i*600))*w*0.08;
        ctx.save();
        ctx.globalAlpha = 0.10+0.05*Math.sin(t/(1700+i*1100));
        ctx.beginPath();
        ctx.arc(cx,cy,r,0,Math.PI*2);
        let c = [
          `rgba(${30+40*i},${30+30*i},${70+90*i},0.9)`,
          `rgba(${100+50*i},${90+40*i},${180+60*i},0.7)`,
          `rgba(${255-60*i},${255-90*i},${255-180*i},0.1)`
        ];
        let nebgrd = ctx.createRadialGradient(cx,cy,r*0.1, cx,cy,r);
        nebgrd.addColorStop(0, c[0]);
        nebgrd.addColorStop(0.5, c[1]);
        nebgrd.addColorStop(1, c[2]);
        ctx.fillStyle = nebgrd;
        ctx.fill();
        ctx.restore();
      }
    }
    // Star field
    const STAR_COUNT = 110;
    let stars = [];
    for (let i=0; i<STAR_COUNT; i++) {
      let layer = Math.floor(Math.random()*3)+1;
      stars.push({
        x: Math.random()*w,
        y: Math.random()*h,
        r: Math.random()*1.1+0.6*layer,
        tw: Math.random()*Math.PI*2,
        spd: Math.random()*0.021+0.009*layer,
        color: `hsl(${50+Math.random()*30},90%,${85+Math.random()*12}%)`,
        layer
      });
    }
    // Shooting stars
    let shootingStars = [];
    function spawnShootingStar() {
      let sx = Math.random()*w, sy = Math.random()*h*0.43 + h*0.12;
      let angle = Math.PI/2 + (Math.random()-0.5)*0.38;
      let speed = 7.5+Math.random()*2.7;
      shootingStars.push({
        x: sx, y: sy, angle, speed,
        life: 0, maxLife: 38+Math.random()*24,
      });
    }
    function drawStars(t) {
      for (let s of stars) {
        s.tw += s.spd;
        let alpha = 0.65 + Math.sin(s.tw*2 + t/1300)*0.23*s.layer;
        let parallax = 5*s.layer;
        let x = s.x + Math.sin(t/(16000+(500*s.layer))+s.x/600)*parallax;
        let y = s.y + Math.cos(t/(12000+(400*s.layer))+s.y/600)*parallax;
        ctx.save();
        ctx.globalAlpha = alpha;
        ctx.beginPath();
        ctx.arc(x, y, s.r, 0, Math.PI*2);
        ctx.fillStyle = s.color;
        ctx.shadowColor = "#fff";
        ctx.shadowBlur = s.r*9 + 2;
        ctx.fill();
        ctx.shadowBlur = 0;
        ctx.restore();
      }
    }
    function updateShootingStars() {
      if (Math.random()<0.012) spawnShootingStar();
      for (let s of shootingStars) {
        s.x += Math.cos(s.angle)*s.speed;
        s.y += Math.sin(s.angle)*s.speed;
        s.life++;
      }
      shootingStars = shootingStars.filter(s=>s.life<s.maxLife && s.x>-80 && s.x<w+80 && s.y>-80 && s.y<h+80);
    }
    function drawShootingStars(t) {
      for (let s of shootingStars) {
        let tail = s.maxLife/2.3;
        ctx.save();
        ctx.globalAlpha = 0.35 - s.life/s.maxLife*0.42;
        ctx.beginPath();
        ctx.moveTo(s.x, s.y);
        ctx.lineTo(s.x-Math.cos(s.angle)*tail, s.y-Math.sin(s.angle)*tail);
        ctx.strokeStyle = `rgba(255,255,255,0.88)`;
        ctx.lineWidth = 2.7;
        ctx.shadowColor = "#FFD900";
        ctx.shadowBlur = 15;
        ctx.stroke();
        ctx.shadowBlur = 0;
        ctx.beginPath();
        ctx.arc(s.x, s.y, 3.9, 0, Math.PI*2);
        ctx.fillStyle = "#FFD900";
        ctx.globalAlpha *= 1.05;
        ctx.fill();
        ctx.restore();
      }
    }
    function animate(t) {
      ctx.clearRect(0,0,w,h);
      drawNebula(t);
      drawStars(t);
      updateShootingStars();
      drawShootingStars(t);
      requestAnimationFrame(animate);
    }
    animate(performance.now());

    // ----------- Game Catalog JS -------------
    const SHEET_URL = 'https://sheets.googleapis.com/v4/spreadsheets/1nw0SDop0IeFr6q776thp_eSCZZulaxZBtM55ECrHD5A/values/games?key=AIzaSyBdnupZe6bJH43XE0Hj77n0AmlR3wVfN9M';
    const catalog = document.getElementById("catalog");
    const thumb = document.querySelector(".thumb");
    const gameGrid = document.getElementById("gameGrid");
    const track = document.querySelector(".track");
    const searchBtn = document.getElementById("searchBtn");
    const searchInput = document.getElementById("searchInput");
    const filterBtn = document.getElementById("filterBtn");
    const filterMenu = document.getElementById("filterMenu");
    const overlay = document.getElementById("gameOverlay");
    const gameContainer = document.getElementById("gameContainer");

    let allGames = [];
    let categories = new Set();

    // Fetch game data from Google Sheets
    async function fetchGameData() {
      try {
        const response = await fetch(SHEET_URL);
        const data = await response.json();
        const rows = data.values;
        const headers = rows.shift();
        const titleIndex = headers.indexOf('Title');
        const categoryIndex = headers.indexOf('Category');
        const urlIndex = headers.indexOf('URL');
        const thumbnailIndex = headers.indexOf('Thumbnail');

        allGames = rows.map(row => ({
          title: row[titleIndex],
          categories: row[categoryIndex] ? row[categoryIndex].split(',').map(c => c.trim()) : [],
          url: row[urlIndex],
          thumbnail: row[thumbnailIndex]
        }));

        categories = new Set();
        allGames.forEach(g => g.categories.forEach(c => categories.add(c)));
        buildFilters();
        renderGames(allGames);
      } catch (e) { console.error("Error fetching game data", e); }
    }

    // Render game cards
    function renderGames(games) {
      gameGrid.innerHTML = "";
      games.forEach(game => {
        const card = document.createElement("div");
        card.className = "game-card";
        card.innerHTML = `
          <h3>${game.title}</h3>
          <img src="${game.thumbnail}" alt="${game.title}">
          <p>${game.categories.join(', ')}</p>
        `;
        card.addEventListener("click", () => openOverlay(game));
        gameGrid.appendChild(card);
      });
    }

    // Build filter buttons
    function buildFilters() {
      filterMenu.innerHTML = "";
      const allBtn = document.createElement("button");
      allBtn.textContent = "All";
      allBtn.onclick = () => renderGames(allGames);
      filterMenu.appendChild(allBtn);
      categories.forEach(cat => {
        const btn = document.createElement("button");
        btn.textContent = cat;
        btn.onclick = () => renderGames(allGames.filter(g => g.categories.includes(cat)));
        filterMenu.appendChild(btn);
      });
    }

    // Open game overlay
    function openOverlay(game) {
      gameContainer.innerHTML = "";
      if (game.url.endsWith(".swf")) {
        gameContainer.innerHTML = `
          <object id="gameObject" type="application/x-shockwave-flash" data="${game.url}" width="800" height="600">
            <param name="movie" value="${game.url}">
            <param name="quality" value="high">
            <param name="wmode" value="transparent">
          </object>
        `;
      } else {
        gameContainer.innerHTML = `<iframe id="gameIframe" src="${game.url}" class="embed"></iframe>`;
      }
      overlay.style.display = "flex";
    }

    function closeOverlay() {
      overlay.style.display = "none";
      gameContainer.innerHTML = "";
    }

    function toggleFullscreen() {
      const el = document.querySelector("#gameIframe") || document.querySelector("#gameObject");
      if (!el) return;
      if (!document.fullscreenElement) {
        el.requestFullscreen().catch(err => console.error(err));
      } else {
        document.exitFullscreen();
      }
    }

    fetchGameData();

    // Sync scrollbar thumb position
    function syncThumb() {
      const ratio = catalog.scrollTop / (catalog.scrollHeight - catalog.clientHeight);
      const trackHeight = track.clientHeight - thumb.clientHeight;
      thumb.style.top = (track.offsetTop + ratio * trackHeight) + "px";
    }
    catalog.addEventListener("scroll", syncThumb);

    let dragging = false;
    let startY, startTop;
    thumb.addEventListener("mousedown", e => {
      dragging = true;
      startY = e.clientY;
      startTop = parseInt(thumb.style.top) || 0;
      thumb.style.cursor = "grabbing";
    });
    document.addEventListener("mousemove", e => {
      if (!dragging) return;
      const dy = e.clientY - startY;
      const trackHeight = track.clientHeight - thumb.clientHeight;
      let newTop = Math.min(track.offsetTop + trackHeight, Math.max(track.offsetTop, startTop + dy));
      thumb.style.top = newTop + "px";
      const ratio = (newTop - track.offsetTop) / trackHeight;
      catalog.scrollTop = ratio * (catalog.scrollHeight - catalog.clientHeight);
    });
    document.addEventListener("mouseup", () => {
      dragging = false;
      thumb.style.cursor = "grab";
    });

    // --- Search functionality ---
    searchBtn.addEventListener("click", () => {
      searchBtn.classList.toggle("active");
      if (searchBtn.classList.contains("active")) {
        searchInput.focus();
      } else {
        searchInput.value = "";
        renderGames(allGames);
      }
    });
    searchInput.addEventListener("input", e => {
      const term = e.target.value.toLowerCase();
      renderGames(allGames.filter(g => g.title.toLowerCase().includes(term)));
    });

    // --- Filter functionality ---
    filterBtn.addEventListener("click", () => {
      filterBtn.classList.toggle("active");
    });

    // --- Overlay escape key close ---
    document.addEventListener("keydown", e => {
      if (e.key === "Escape" && overlay.style.display === "flex") {
        closeOverlay();
      }
    });
  </script>
</body>
</html>
