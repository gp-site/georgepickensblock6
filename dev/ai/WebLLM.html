<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>WebLLM Demo (No Backend)</title>
  <style>
    body { font-family: system-ui; margin: 2rem; max-width: 760px; }
    textarea { width:100%; min-height:100px; }
    pre { background:#111; color:#eee; padding:1rem; white-space:pre-wrap; }
  </style>
  <script src="https://unpkg.com/@mlc-ai/web-llm@0.2.61/dist/index.js"></script>
</head>
<body>
  <h1>WebLLM Local Chat</h1>
  <p>This runs a quantized model in your browser. First load may take a while.</p>
  <div>
    <label>Prompt:</label>
    <textarea id="prompt">Explain what a transformer model is in simple terms.</textarea>
    <button id="runBtn">Run</button>
  </div>
  <h3>Output</h3>
  <pre id="out"></pre>
  <script>
    const out = document.getElementById('out');
    const runBtn = document.getElementById('runBtn');

    // Choose a smaller model for faster load; see WebLLM docs for list.
    const model = 'Mistral-7B-Instruct-q4f16_1';

    let engine;
    async function init() {
      out.textContent = 'Initializing model (first load can be several hundred MB for bigger models)...';
      engine = await webllm.CreateMLCEngine(model, {
        initProgressCallback: (p) => {
          out.textContent = `Loading: ${(p.progress * 100).toFixed(1)}% - ${p.text}`;
        }
      });
      out.textContent = 'Model ready.';
    }

    runBtn.onclick = async () => {
      if (!engine) return;
      const prompt = document.getElementById('prompt').value.trim();
      out.textContent = 'Generating...\n';
      let full = '';
      const chunks = await engine.chat.completions.create({
        messages: [{ role: 'user', content: prompt }],
        stream: true,
        temperature: 0.7,
        max_tokens: 300
      });
      for await (const part of chunks) {
        if (part.choices && part.choices[0]?.delta?.content) {
          full += part.choices[0].delta.content;
          out.textContent = full;
        }
      }
    };

    init();
  </script>
</body>
</html>